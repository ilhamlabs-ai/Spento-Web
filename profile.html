<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - Spento</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #5B9FED 0%, #5DD5C3 100%); }
    </style>
</head>
<body class="bg-gray-50">
    
    <!-- Top Navigation -->
    <nav class="gradient-bg text-white p-4 sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto flex justify-between items-center max-w-4xl">
            <h1 class="text-2xl font-bold">Profile</h1>
            <button id="editBtn" class="text-white hover:text-gray-200">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                </svg>
            </button>
        </div>
    </nav>

    <div class="container mx-auto p-4 pb-24 max-w-4xl">
        
        <!-- Profile Card -->
        <div class="gradient-bg rounded-2xl p-8 mb-6 text-white shadow-lg text-center">
            <div class="w-24 h-24 rounded-full bg-white/20 flex items-center justify-center mx-auto mb-4 overflow-hidden">
                <img id="userPhoto" class="w-full h-full object-cover" alt="User Photo">
                <svg id="defaultAvatar" class="w-12 h-12 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
            </div>
            <h2 id="userName" class="text-2xl font-bold mb-2">User Name</h2>
            <p id="userEmail" class="opacity-90 mb-4">user@example.com</p>
            <div class="inline-block bg-white/20 px-4 py-2 rounded-full text-sm">
                Email Account
            </div>

            <div class="grid grid-cols-3 gap-4 mt-6 pt-6 border-t border-white/20">
                <div>
                    <div class="text-3xl font-bold" id="totalBills">0</div>
                    <div class="text-sm opacity-90">Bills</div>
                </div>
                <div>
                    <div class="text-3xl font-bold">â‚¬<span id="totalSpent">0</span></div>
                    <div class="text-sm opacity-90">Total Spent</div>
                </div>
                <div>
                    <div class="text-3xl font-bold" id="joinedDate">2025</div>
                    <div class="text-sm opacity-90">Joined</div>
                </div>
            </div>
        </div>

        <!-- Activity Overview -->
        <div class="bg-white rounded-2xl p-6 mb-6 shadow-lg">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Activity Overview</h3>
            <div class="grid grid-cols-3 gap-4">
                <div class="bg-teal-50 rounded-xl p-4 text-center">
                    <svg class="w-8 h-8 mx-auto mb-2 text-teal-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                    <div class="text-2xl font-bold text-teal-700" id="thisWeekBills">0</div>
                    <div class="text-xs text-teal-600 font-medium">This Week</div>
                </div>
                
                <div class="bg-purple-50 rounded-xl p-4 text-center">
                    <svg class="w-8 h-8 mx-auto mb-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                    <div class="text-2xl font-bold text-purple-700" id="thisMonthBills">0</div>
                    <div class="text-xs text-purple-600 font-medium">This Month</div>
                </div>
                
                <div class="bg-pink-50 rounded-xl p-4 text-center">
                    <svg class="w-8 h-8 mx-auto mb-2 text-pink-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"/>
                    </svg>
                    <div class="text-2xl font-bold text-pink-700" id="categoryCount">0</div>
                    <div class="text-xs text-pink-600 font-medium">Categories</div>
                </div>
            </div>
        </div>

        <!-- Settings -->
        <div class="bg-white rounded-2xl p-6 shadow-lg">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Settings</h3>
            
            <div class="space-y-3">
                <button class="w-full flex items-center justify-between p-4 bg-gray-50 hover:bg-gray-100 rounded-xl transition">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center">
                            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                            </svg>
                        </div>
                        <div class="text-left">
                            <div class="font-semibold text-gray-800">Notifications</div>
                            <div class="text-sm text-gray-500">Manage your notifications</div>
                        </div>
                    </div>
                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                </button>

                <button class="w-full flex items-center justify-between p-4 bg-gray-50 hover:bg-gray-100 rounded-xl transition">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center">
                            <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"/>
                            </svg>
                        </div>
                        <div class="text-left">
                            <div class="font-semibold text-gray-800">Data Backup</div>
                            <div class="text-sm text-gray-500">Backup your data</div>
                        </div>
                    </div>
                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                </button>

                <button id="exportBtn" class="w-full flex items-center justify-between p-4 bg-gray-50 hover:bg-gray-100 rounded-xl transition">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center">
                            <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                        </div>
                        <div class="text-left">
                            <div class="font-semibold text-gray-800">Export Data</div>
                            <div class="text-sm text-gray-500">Download your bills as CSV</div>
                        </div>
                    </div>
                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                </button>

                <button class="w-full flex items-center justify-between p-4 bg-gray-50 hover:bg-gray-100 rounded-xl transition">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-yellow-100 flex items-center justify-center">
                            <svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <div class="text-left">
                            <div class="font-semibold text-gray-800">Help & Support</div>
                            <div class="text-sm text-gray-500">Get help with Spento</div>
                        </div>
                    </div>
                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                </button>

                <button class="w-full flex items-center justify-between p-4 bg-gray-50 hover:bg-gray-100 rounded-xl transition">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center">
                            <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <div class="text-left">
                            <div class="font-semibold text-gray-800">About Spento</div>
                            <div class="text-sm text-gray-500">Version 1.0.0</div>
                        </div>
                    </div>
                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                </button>
            </div>

            <button id="logoutBtn" class="w-full mt-6 gradient-bg text-white py-4 rounded-xl font-semibold hover:shadow-lg transition">
                ðŸšª Logout
            </button>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 py-3 shadow-lg">
        <div class="container mx-auto flex justify-around items-center max-w-4xl">
            <a href="dashboard.html" class="flex flex-col items-center text-gray-500">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg>
                <span class="text-xs mt-1">Dashboard</span>
            </a>
            <a href="upload.html" class="flex flex-col items-center text-gray-500">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg>
                <span class="text-xs mt-1">Upload</span>
            </a>
            <a href="bills.html" class="flex flex-col items-center text-gray-500">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                <span class="text-xs mt-1">Bills</span>
            </a>
            <a href="analytics.html" class="flex flex-col items-center text-gray-500">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
                <span class="text-xs mt-1">Analytics</span>
            </a>
            <a href="profile.html" class="flex flex-col items-center text-blue-500">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                <span class="text-xs mt-1 font-medium">Profile</span>
            </a>
        </div>
    </nav>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
        import { getFirestore, collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyC6QYvm6Y_lb7aO_v2bSepXZ6qxBxkkuyE",
            authDomain: "biller-app-13fb1.firebaseapp.com",
            projectId: "biller-app-13fb1",
            storageBucket: "biller-app-13fb1.firebasestorage.app",
            messagingSenderId: "563377160023",
            appId: "1:563377160023:web:533869f1ed33b2bfe6c812",
            measurementId: "G-NLT1KF5B10"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                window.location.href = 'index.html';
                return;
            }
            
            // Display user info
            document.getElementById('userName').textContent = user.displayName || 'User';
            document.getElementById('userEmail').textContent = user.email;
            
            if (user.photoURL) {
                document.getElementById('userPhoto').src = user.photoURL;
            } else {
                document.getElementById('userPhoto').classList.add('hidden');
                document.getElementById('defaultAvatar').classList.remove('hidden');
            }
            
            // Join date
            const joinDate = user.metadata.creationTime ? 
                new Date(user.metadata.creationTime).toLocaleDateString('en-US', { month: 'short', year: 'numeric' }) : 
                'Recently';
            document.getElementById('joinedDate').textContent = joinDate;

            await loadUserStats(user.uid);
        });

        async function loadUserStats(userId) {
            try {
                const bills = [];
                snapshot.forEach(doc => {
                    bills.push({ id: doc.id, ...doc.data() });
                });

                // Calculate stats
                const total = bills.reduce((sum, bill) => sum + parseFloat(bill.amount || 0), 0);
                
                const now = new Date();
                const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
                
                let thisWeek = 0, thisMonth = 0;
                const categories = new Set();
                
                bills.forEach(bill => {
                    const billDate = bill.created_at?.toDate() || new Date(bill.date);
                    if (billDate >= weekAgo) thisWeek++;
                    if (billDate >= monthStart) thisMonth++;
                    if (bill.category) categories.add(bill.category);
                });

                // Update UI
                document.getElementById('totalBills').textContent = bills.length;
                document.getElementById('totalSpent').textContent = total.toFixed(0);
                document.getElementById('thisWeekBills').textContent = thisWeek;
                document.getElementById('thisMonthBills').textContent = thisMonth;
                document.getElementById('categoryCount').textContent = categories.size;

            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', async () => {
            if (confirm('Are you sure you want to logout?')) {
                await signOut(auth);
                window.location.href = 'index.html';
            }
        });

        // Export data
        document.getElementById('exportBtn').addEventListener('click', async () => {
            try {
                const user = auth.currentUser;
                const billsRef = collection(db, 'bills');
                const q = query(billsRef, where('ownerId', '==', user.uid));
                const snapshot = await getDocs(q);
                
                const bills = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    bills.push({
                        Name: data.name || 'Unnamed',
                        Category: data.category || 'miscellaneous',
                        Amount: data.amount || 0,
                        Date: data.date || 'Unknown',
                        Source: data.source || 'unknown',
                        Items: data.items?.length || 0
                    });
                });

                // Convert to CSV
                const headers = Object.keys(bills[0] || {});
                const csv = [
                    headers.join(','),
                    ...bills.map(row => headers.map(h => row[h]).join(','))
                ].join('\n');

                // Download
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `spento_bills_${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
                window.URL.revokeObjectURL(url);

                // Show success message
                const successDiv = document.createElement('div');
                successDiv.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-4 rounded-lg shadow-lg z-50';
                successDiv.textContent = 'âœ… Data exported successfully!';
                document.body.appendChild(successDiv);
                setTimeout(() => successDiv.remove(), 3000);

            } catch (error) {
                alert('Failed to export data. Please try again.');
                console.error('Export error:', error);
            }
        });
    </script>
</body>
</html>Ref = collection(db, 'bills');
                const q = query(billsRef, where('ownerId', '==', userId));
                const snapshot = await getDocs(q);
                
                const bills